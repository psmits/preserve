\documentclass[12pt,letterpaper]{article}

\usepackage{amsmath, amsthm}
\usepackage{microtype, parskip}
\usepackage[comma,numbers,sort&compress]{natbib}
\usepackage{lineno}
\usepackage{docmute}
\usepackage{caption, subcaption, multirow, morefloats, rotating}
\usepackage{wrapfig}

\frenchspacing

\begin{document}
\section{Materials and Methods}

\subsection{Taxon occurrence information}

\subsection{Geographic provinces}

\subsection{Model specification}
Taxon presence was modeled has a hierarchical two-state hidden Markov model (HMM) where the three ``process parameters'' of gain/newly entering a province (\(\gamma\)), persistance/survival (\(\phi\)), and observation (\(p\)). For each province, each of these process parameters were modeled hierarchically so that estimates were allowed to vary over time but in cases of little information those estimates were drawn to the overall mean for that province. The estimates for each province were also estimated hierarchically in relation to each other; this way all estimates were relative to each other. The hierarchical structure of this model helps control for both overfitting and multiple comparisons during posterior analysis \citep{Gelman2007,Gelman2013d}. 

Note that the following model is strongly inspired by the dynamic occupancy model presented in \citep{Royle2008}.

\(y_{i, j, t}\) is the observed occurrence of taxon \(i\) in province \(j\) at time \(t\), where \(i = 1, 2, \dots, N\), \(j = 1, 2, \dots, J\), and \(t = 1, 2, \dots, T\). \(y = 1\) is occupied while \(y = 0\) is unoccupied. \(z_{i, j, t}\) is the ``true'' occurrence of taxon \(i\) in province \(j\) at time \(t\), given the estimate of sampling. Just as with \(y\), \(z = 1\) is occupied while \(z = 0\) is unoccupied. 

\(\phi_{j, t}\) is the probability of surviving, in province \(j\), from time \(t\) to time \(t + 1\) (\(Pr(z_{t + 1} = 1 | z_{t} = 1)\)). \(\gamma_{j, t}\) is the probability of newly entering province \(j\) at time \(t + 1\) (\(Pr(z_{t + 1} = 1 | z_{t} = 0)\)). \(p_{j, t}\) is the probability of observing a true occurrence (\(Pr(y = 1 | z = 1)\)) in province \(j\) at time \(t\). 

\(\psi\) is probability of sit occupancy/probability of occurrence (\(Pr(z_{i, t = 1} = 1)\). The first time point is defined in terms of \(\psi\) because there is (assumed) no previous time points.

The parameters \(\phi\), \(\gamma\), and \(p\) are then all defined hierarchically within each province, hierarchical by time bin with the mean of that hierarchical by province. \(\Phi_{j}\), \(\Gamma_{j}\), and \(P_{j}\) are the overall probabilities for province \(j\). \(M_{\phi}\), \(M_{\gamma}\), and \(M_{p}\) are the overall estimates of survival, origination, and preservation probabilities. 

Diversity dependent origination and survival was included as a regression coefficients in the parameterizations of \(\phi_{j, t}\), and \(\gamma_{j, t}\). In particular, the diversity of any province can affect the origination and survival probabilities of an province; this is conceptually and mathematically similar to how clade competition was modeled by \citet{Silvestro2015b}. 

\(\alpha\) and \(\beta\) are both \(J \times J\) matrices of regression coefficients, where \(\beta_{j}\) would be a column vector. \(X\) is a \(J \times T\) matrix where \(X_{t}\) is a column vector where each element is defined \(X_{j, t} = \Sigma_{i = 1}^{N} z_{i, j, t}\) (i.e. the sum of the diversity in province \(j\) at time \(t\)). All regression coefficients (i.e. all elements of the matrices) are given weakly-informative independent normally distributed priors.

And finally, I use independent uniform priors for \(\psi_{j}\) by province \(j\): \(\psi_{j} \sim \mathrm{U}(0, 1)\).

In total, the model can be summarized by the following statements:

\begin{equation}
  \begin{aligned}
    y_{i, t, j} &\sim \mathrm{Bern}(p_{t, j} z_{i, t, j}) \\
    z_{i, t = 1, j} &\sim \mathrm{Bern}(\psi_{j}) \\
    z_{i, t, j} &\sim \mathrm{Bern}(\phi_{j, t - 1} z_{i, t - 1, j} + \gamma_{j, t - 1} (1 - z_{i, t - 1, j})) \\
    \mathrm{logit}(\phi_{j, t}) &\sim \mathrm{N}(\Phi_{j} + X_{t - 1}\beta_{j}, \sigma_{\phi, j}) \\
    \mathrm{logit}(\gamma_{j, t}) &\sim \mathrm{N}(\Gamma_{j} + X_{t - 1}\alpha_{j}, \sigma_{\gamma, j}) \\
    \mathrm{logit}(p_{j, t}) &\sim \mathrm{N}(P_{j}, \sigma_{p, j}) \\
    \Phi_{j} &\sim \mathrm{N}(M_{\phi}, \sigma_{\Phi}) \\
    \Gamma_{j} &\sim \mathrm{N}(M_{\gamma}, \sigma_{\Gamma}) \\
    P_{j} &\sim \mathrm{N}(M_{p}, \sigma_{P}) \\
    \sigma_{\phi, j} &\sim \mathrm{C}^{+}(1) \\
    M_{\phi} &\sim \mathrm{N}(0, 1) \\
    \sigma_{\Phi} &\sim \mathrm{C}^{+}(1) \\
    \beta &\sim \mathrm{N}(0, 1) \\
    \sigma_{\gamma, j} &\sim \mathrm{C}^{+}(1) \\
    M_{\gamma} &\sim \mathrm{N}(0, 1) \\
    \sigma_{\Gamma} &\sim \mathrm{C}^{+}(1) \\
    \alpha &\sim \mathrm{N}(0, 1) \\
    \sigma_{p, j} &\sim \mathrm{C}^{+}(1) \\
    M_{p} &\sim \mathrm{N}(0, 1) \\
    \sigma_{P} &\sim \mathrm{C}^{+}(1) \\
  \end{aligned}
\end{equation}


The joint posterior distribution of the HMM model was approximated using a Gibbs sampling MCMC routine as implemented in the JAGS probablistic programming language CITATION. Four chains were run for 20000 steps, thined to every 10th sample, ans split evenly between warm-up and sampling phases. Chain sampling convergence was assessed using the \(\hat{R}\) statistic with values close to 1 (less than 1.1) indicating approximate convergence \citep{Gelman2013d}.

\end{document}
